{
  "openapi": "3.0.3",
  "info": {
    "title": "Unisalones API",
    "version": "1.0.0",
    "description": "API REST del Sistema de Gestión de Espacios - Unicomfacauca (Unisalones)",
    "contact": {
      "name": "Equipo Unisalones"
    }
  },
  "servers": [
    {
      "url": "http://localhost:{port}/api",
      "variables": {
        "port": {
          "default": "3000"
        }
      },
      "description": "Servidor local (desarrollo)"
    }
  ],
  "tags": [
    {
      "name": "Auth",
      "description": "Autenticación y usuarios"
    },
    {
      "name": "Spaces",
      "description": "Gestión y disponibilidad de espacios"
    },
    {
      "name": "Reservations",
      "description": "Reservas de espacios"
    },
    {
      "name": "Notifications",
      "description": "Notificaciones de reservas"
    }
  ],
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT",
        "description": "Introduce el token con el formato: Bearer <tu_token_JWT>"
      }
    },
    "schemas": {
      "Space": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer"
          },
          "name": {
            "type": "string"
          },
          "capacity": {
            "type": "integer"
          }
        }
      },
      "Reservation": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer"
          },
          "spaceId": {
            "type": "integer"
          },
          "userId": {
            "type": "integer"
          },
          "startTime": {
            "type": "string",
            "format": "date-time"
          },
          "endTime": {
            "type": "string",
            "format": "date-time"
          },
          "status": {
            "type": "string",
            "enum": [
              "PENDING",
              "CONFIRMED",
              "CANCELLED"
            ]
          }
        }
      },
      "ApiError": {
        "type": "object",
        "properties": {
          "message": {
            "type": "string"
          },
          "details": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        }
      }
    }
  },
  "security": [
    {
      "bearerAuth": []
    }
  ],
  "paths": {
    "/auth/register": {
      "post": {
        "summary": "Registro de un nuevo usuario",
        "description": "Permite registrar un nuevo usuario como administrador o estudiante.",
        "tags": [
          "Auth"
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "name",
                  "email",
                  "password",
                  "role"
                ],
                "properties": {
                  "name": {
                    "type": "string",
                    "example": "Juan Pérez"
                  },
                  "email": {
                    "type": "string",
                    "example": "juan@unicomfacauca.edu.co"
                  },
                  "password": {
                    "type": "string",
                    "example": 123456
                  },
                  "role": {
                    "type": "string",
                    "enum": [
                      "admin",
                      "student"
                    ],
                    "example": "student"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Usuario creado exitosamente."
          },
          "400": {
            "description": "Datos inválidos."
          },
          "422": {
            "description": "Error de validación."
          }
        }
      }
    },
    "/auth/login": {
      "post": {
        "summary": "Iniciar sesión en el sistema",
        "description": "Devuelve un token JWT si las credenciales son válidas.",
        "tags": [
          "Auth"
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "email",
                  "password"
                ],
                "properties": {
                  "email": {
                    "type": "string",
                    "example": "juan@unicomfacauca.edu.co"
                  },
                  "password": {
                    "type": "string",
                    "example": 123456
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Inicio de sesión exitoso, devuelve token JWT."
          },
          "400": {
            "description": "Credenciales inválidas."
          },
          "422": {
            "description": "Error de validación."
          }
        }
      }
    },
    "/reservations": {
      "post": {
        "tags": [
          "Reservations"
        ],
        "summary": "Crear una nueva reserva",
        "description": "Permite al usuario autenticado crear una reserva de un espacio disponible.",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "spaceId",
                  "startTime",
                  "endTime"
                ],
                "properties": {
                  "spaceId": {
                    "type": "integer"
                  },
                  "startTime": {
                    "type": "string",
                    "format": "date-time",
                    "example": "2025-11-09T08:00:00Z"
                  },
                  "endTime": {
                    "type": "string",
                    "format": "date-time",
                    "example": "2025-11-09T09:00:00Z"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Reserva creada exitosamente"
          },
          "400": {
            "description": "Error en los datos o conflicto de horario"
          },
          "401": {
            "description": "Usuario no autenticado"
          }
        }
      },
      "get": {
        "tags": [
          "Reservations"
        ],
        "summary": "Listar todas las reservas",
        "description": "Devuelve todas las reservas registradas (solo administradores o personal autorizado).",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Lista completa de reservas"
          },
          "401": {
            "description": "No autenticado"
          }
        }
      }
    },
    "/reservations/{id}": {
      "patch": {
        "tags": [
          "Reservations"
        ],
        "summary": "Modificar una reserva existente",
        "description": "Permite al usuario autenticado actualizar los datos de su reserva.",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "ID de la reserva a modificar"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "startTime": {
                    "type": "string",
                    "format": "date-time"
                  },
                  "endTime": {
                    "type": "string",
                    "format": "date-time"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Reserva modificada exitosamente"
          },
          "400": {
            "description": "Datos inválidos o conflicto de horario"
          },
          "401": {
            "description": "Usuario no autenticado"
          }
        }
      },
      "delete": {
        "tags": [
          "Reservations"
        ],
        "summary": "Cancelar una reserva",
        "description": "Cancela la reserva del usuario autenticado.",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "schema": {
              "type": "integer"
            },
            "description": "ID de la reserva a cancelar"
          }
        ],
        "responses": {
          "200": {
            "description": "Reserva cancelada exitosamente"
          },
          "401": {
            "description": "Usuario no autenticado"
          },
          "404": {
            "description": "Reserva no encontrada"
          }
        }
      }
    },
    "/reservations/me": {
      "get": {
        "tags": [
          "Reservations"
        ],
        "summary": "Listar reservas del usuario autenticado",
        "description": "Devuelve el historial de reservas del usuario que inició sesión.",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Historial de reservas del usuario"
          },
          "401": {
            "description": "No autenticado"
          }
        }
      }
    },
    "/reservations/waitlist": {
      "post": {
        "tags": [
          "Reservations"
        ],
        "summary": "Unirse a la lista de espera",
        "description": "Agrega al usuario autenticado a la lista de espera de un espacio ya ocupado.",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "spaceId",
                  "reservationDate"
                ],
                "properties": {
                  "spaceId": {
                    "type": "integer"
                  },
                  "reservationDate": {
                    "type": "string",
                    "format": "date",
                    "example": "2025-11-10"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Usuario añadido a la lista de espera"
          },
          "400": {
            "description": "Error en los datos"
          },
          "401": {
            "description": "No autenticado"
          }
        }
      },
      "get": {
        "tags": [
          "Reservations"
        ],
        "summary": "Obtener lista de espera del usuario autenticado",
        "description": "Devuelve las entradas de lista de espera asociadas al usuario autenticado.",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Lista de espera del usuario"
          },
          "401": {
            "description": "No autenticado"
          }
        }
      }
    },
    "/spaces/available": {
      "get": {
        "tags": [
          "Spaces"
        ],
        "summary": "Consultar espacios disponibles",
        "description": "Devuelve la disponibilidad de los espacios según los filtros de fecha u hora.",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "query",
            "name": "date",
            "schema": {
              "type": "string",
              "format": "date"
            },
            "description": "Fecha para verificar la disponibilidad (YYYY-MM-DD)"
          },
          {
            "in": "query",
            "name": "start",
            "schema": {
              "type": "string",
              "example": "08:00"
            },
            "description": "Hora inicial del rango de búsqueda (HH:mm)"
          },
          {
            "in": "query",
            "name": "end",
            "schema": {
              "type": "string",
              "example": "18:00"
            },
            "description": "Hora final del rango de búsqueda (HH:mm)"
          },
          {
            "in": "query",
            "name": "spaceId",
            "schema": {
              "type": "integer"
            },
            "description": "ID del espacio específico a consultar"
          }
        ],
        "responses": {
          "200": {
            "description": "Lista de espacios con sus intervalos disponibles",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "spaceId": {
                        "type": "integer"
                      },
                      "slots": {
                        "type": "array",
                        "items": {
                          "type": "object",
                          "properties": {
                            "start": {
                              "type": "string"
                            },
                            "end": {
                              "type": "string"
                            },
                            "status": {
                              "type": "string",
                              "enum": [
                                "available",
                                "reserved"
                              ]
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Petición inválida"
          },
          "401": {
            "description": "No autorizado"
          }
        }
      }
    },
    "/spaces": {
      "post": {
        "tags": [
          "Spaces"
        ],
        "summary": "Crear un nuevo espacio",
        "description": "Solo los administradores pueden crear nuevos espacios.",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "name",
                  "capacity"
                ],
                "properties": {
                  "name": {
                    "type": "string"
                  },
                  "capacity": {
                    "type": "integer"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Espacio creado correctamente"
          },
          "400": {
            "description": "Datos inválidos"
          },
          "401": {
            "description": "No autorizado"
          },
          "403": {
            "description": "Prohibido"
          }
        }
      },
      "get": {
        "tags": [
          "Spaces"
        ],
        "summary": "Listar todos los espacios",
        "description": "Devuelve todos los espacios registrados.",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Lista de espacios"
          },
          "401": {
            "description": "No autorizado"
          }
        }
      }
    },
    "/spaces/{id}": {
      "get": {
        "tags": [
          "Spaces"
        ],
        "summary": "Obtener un espacio por ID",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "schema": {
              "type": "integer"
            },
            "required": true,
            "description": "ID del espacio"
          }
        ],
        "responses": {
          "200": {
            "description": "Datos del espacio encontrado"
          },
          "404": {
            "description": "Espacio no encontrado"
          }
        }
      },
      "put": {
        "tags": [
          "Spaces"
        ],
        "summary": "Actualizar un espacio",
        "description": "Solo administradores pueden modificar los datos de un espacio.",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "schema": {
              "type": "integer"
            },
            "required": true,
            "description": "ID del espacio a actualizar"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string"
                  },
                  "capacity": {
                    "type": "integer"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Espacio actualizado correctamente"
          },
          "400": {
            "description": "Datos inválidos"
          },
          "403": {
            "description": "No autorizado"
          }
        }
      },
      "delete": {
        "tags": [
          "Spaces"
        ],
        "summary": "Eliminar un espacio",
        "description": "Solo administradores pueden eliminar espacios.",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "schema": {
              "type": "integer"
            },
            "required": true,
            "description": "ID del espacio a eliminar"
          }
        ],
        "responses": {
          "200": {
            "description": "Espacio eliminado correctamente"
          },
          "401": {
            "description": "No autorizado"
          },
          "403": {
            "description": "Prohibido"
          }
        }
      }
    }
  }
}